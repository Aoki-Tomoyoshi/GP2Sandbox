# チーム開発の準備

チーム開発に向けたGitの機能を練習します。

## ブランチ
Gitはオープンソースプロジェクトの開発を想定したツールです。リポジトリーを公開して、常に誰からアクセスされても構わないようにしておくのが基本です。

開発途中で作業時間が終わった場合に、そのままコミットとプッシュをすると、エラーがでるような状態のプロジェクトになってしまいます。これだとそのプロジェクトを使ってみたい人にとっては不便です。かといって、エラーがでない状態になるまでプッシュができないというのも不便です。

そこで、バージョン管理システムには**ブランチ**というものが用意されています。日本語で **枝** のことで、リポジトリーを枝分かれさせて、複数の状態を同時に保存できるようにするものです。

最初に割り当てられる**main** (以前は **master** )ブランチは、常に動作可能な状態にしておくのが一般的です。開発をする時にはmainから開発用のブランチを作成して、その開発用のブランチにコミットやプッシュをします。ブランチは独立しているのでmainブランチは動作する状態が維持されます。

開発が一段落して問題なく動作するようになったら、開発用ブランチをmainブランチに **マージ(=merge 結合)** します。これでmainブランチは常に動作する状態に保つことができます。開発を続行する時は、先の開発用ブランチで再び作業をするか、新しい開発用のブランチを作成して作業します。

理解を深めるために、実際に操作をしてみましょう。

### ブランチを作る
開発用のブランチ`dev`を作成してみます。ブランチを切り替える操作をする際には、以下の2点に注意してください。

- ブランチの操作をする前に、変更中のファイルを0にします
- ブランチの切り替え操作中は、Unityに切り替えないでください

![Changes](./images/img01.png)

変更中のファイルがある状態でブランチを切り替えると状態の把握が難しくなります。作業中のファイルならコミット、変更を破棄して構わないならDiscardをしましょう。

ここでは何も変更をしていないはずなので、ChangesにファイルがあったらDiscard Allで変更を戻しておいてください。

1. GitHub Desktopに切り替えて、Current branchをクリック > Filter 欄に`dev`と入力 > Create New branch ボタンを押します

![ブランチ名の入力](./images/img02.png)

2. 続けて Create branch ボタンを押します

これで開発用のブランチ`dev`ができました。少し変更を加えてみます。

1. Unityに切り替えて、Projectウィンドウから GP2Sandbox > Scenes フォルダーを開いて、 System シーンをダブルクリックして開きます
1. Hierarchyウィンドウの + をクリックして、3D Object > Sphereを選んで球体を作ります
1. Fileメニューから Save を選択して保存します
1. GitHub Desktopに切り替えて、Summary欄に`Sphereを作成`などと入力してコミットします

![球体の作成とコミット](./images/img03.png)

以上でdevブランチに変更を加えてコミットしました。それではmainブランチに切り替えてみます。

1. GitHub DesktopのCurrent branchをクリックして main を選択します

![mainブランチへ](./images/img04.png)

2. Unityに切り替えてReloadをクリックします

mainブランチはdevブランチを作成した時点の状態のままなので、先ほど作成したSphereがなくなって元の状態に戻ったことが確認できます。

![Sphereが無くなって元に戻っている](./images/img05.png)

同様の操作でdevブランチに戻してみましょう。

1. GitHub DesktopのCurrent branchをクリックして dev を選択します
1. Unityに切り替えて、Reloadをクリックします

Sphereが復活します。

![devに戻す](./images/img06.png)

このようにブランチを利用すると、プロジェクトの様々な状態を同時に保存することができます。**ファイルを変更したままブランチを切り替えない限り**、マージするまでは他のブランチを破壊することはありません。

この性質を利用して、常にリポジトリーのmainブランチを実行可能な状態に保ったり、複数のメンバーが別々にプロジェクトの開発を進めることができます。


## マージ

開発が一段落して動作可能な状態になったら、開発ブランチで行った作業をmainブランチに結合します。これを **マージ(Merge)** と呼びます。

devで追加したSphereを、mainブランチにも反映させてみます。マージは **マージ先のブランチに切り替えて、マージ元のブランチを指定** します。

1. GitHub DesktopのCurrent branchを、**マージ先**であるmainに切り替えます
1. ブランチの切り替えが完了したら、Unityを選択してReloadして変更を反映させます
1. GitHub Desktopに切り替えて、Current branchをクリックして、一番下の Choose a branch to merge into main をクリックします

![マージ開始](./images/img07.png)

4. マージ元のdevブランチをクリックして選択して、 Merge dev into main をクリックします

![マージ元のブランチの指定](./images/img08.png)

以上でマージ完了です。Unityに切り替えてReloadをしてください。mainブランチにもSphereが追加されます。Push origin すればGitHubにも更新が反映します。

一人で開発するなら、以上でmainを動作する状態に保ったまま開発が進められます。

## 簡易的なチーム開発

ブランチの作成方法とマージの仕方が分かりました。チームメンバーを共同開発者にして、メンバーそれぞれが自分の作業用のブランチを作って、そこで作業して、mainブランチにマージをすれば共同開発ができそうです。試してみましょう。

### シナリオ

以下のようなシナリオを考えます。

- AさんとBさんが同時に開発します
- Aさんは`dev`、Bさんは`devB`ブランチで作業をします
- Aさんは、SphereをGameシーンに移して、配置する作業を担当します
- Bさんは、GameシーンにCubeを作成して、配置する作業を担当します

AさんとBさんの両役になって作業を進めてみましょう。

### 作業手順

まずはAさんの作業をします。

1. GitHub Desktopでdevブランチに切り替えます
1. Unityに切り替えます
1. Projectウィンドウの GP2Sandbox/Scenes フォルダーから Game シーンをHierarchyウィンドウにドラッグ&ドロップします
1. Hierarchyウィンドウで、Systemシーンに作成したSphereをドラッグして、Gameシーンに移動します

![SphereをGameシーンへ](./images/img09.png)

5. SphereをX=`2`, Y=`0`, Z=`2` あたりに移動します(実際はどこでもいいです)

![Sphereを配置](./images/img10.png)

6. FileメニューからSaveでシーンを保存します

以上でAさんの担当作業は完了です。コミットしておきます。まだマージはしないでください。

7. GitHub Desktopに切り替えます
1. Summaryに`Sphereを配置`など入力してコミットします

![Aさんの作業をコミット](./images/img11.png)

次にBさん役になって作業を進めます。

1. GitHub Desktopで、mainブランチに切り替えます
1. Unityに切り替えてReloadします。Sphereが元に戻るのを確認します
1. GitHub Desktopに切り替えます
1. ブランチの作成手順を確認して、`devB`ブランチを作成します
1. Unityに切り替えます
1. Hierarchyウィンドウの + をクリックして、3D Object > Cubeを選択して、Cubeを生成します
1. 先ほどのSphereの操作と同様に、作成したCubeをドラッグしてGameシーンでドロップしてGameシーンへ移動します
1. CubeをX=`-2`, Y=`0`, Z=`-2`あたりに移動させてみます

![Cubeを配置](./images/img12.png)

9. FileメニューからSaveでシーンを保存します

以上で作業完了です。コミットしておきます。

10. GitHub Desktopに切り替えます
1. Summaryに`Cubeを配置`など入力してコミットします

以上でAとB両者の作業が完了しました。mainにマージします。

1. GitHub DesktopのCurrent branchを、**マージ先**であるmainに切り替えます
1. ブランチの切り替えが完了したら、Unityを選択してReloadして変更を反映させます
1. GitHub Desktopに切り替えて、Current branchをクリックして、一番下の Choose a branch to merge into main をクリックします

![マージ開始](./images/img07.png)

4. マージ元のdevブランチをクリックして選択して、 Merge dev into main をクリックします

![マージ元のブランチの指定](./images/img08.png)

Unityに切り替えてReloadをして、mainブランチにAさんの作業が反映されたことを確認します。続けてBさんの作業をマージします。

5. GitHub Desktopに切り替えて、Current branchをクリックして、一番下の Choose a branch to merge into main をクリックします
1. マージ元のdevBブランチをクリックして選択して、 Merge dev into main をクリックします
1. マージが完了したら、Unityに切り替えてReloadします

以上で、両者の作業が結合できました。

## コンフリクト体験

ではGitのハマりポイントである **コンフリクト(=Conflict 衝突)** を試してみます。まずはdevブランチとdevBブランチにmainブランチをマージしてmainの状態に統一します。

1. GitHub Desktopでdevブランチに切り替えます
1. Current branchをクリックして、Choose a branch to merge into dev をクリックします
1. mainを選択して、Merge main into dev をクリックします

これでdevがmainと同じになりました。devBも同様の手順でmainをマージしてください。

それではコンフリクトを発生させます。今はdevBブランチのはずなので、そこで以下の変更をします

1. Unityに切り替えます
1. HierarchyウィンドウのSphereとCubeのX座標を両方とも`0`にします
1. FileメニューからSaveを選択して保存します
1. `X座標を0`などでコミットします

![devBのXを0に設定](./images/img13.png)

1. GitHub Desktopに切り替えて、devブランチに切り替えます
1. Unityに切り替えてReloadします
1. HierarchyウィンドウのSphereのX座標を`-2`、CubeのX座標を`2`にして場所を入れ替えます
1. FileメニューからSaveを選択して保存します
1. `X座標を反転`などでコミットします

![devのSphereとCubeのX位置を反転](./images/img14.png)

それではdevとdevBブランチをmainにマージします。





先の例のように、別のメンバーが同時に同じ場所を変更しなければ問題なく作業が進められますが、そのためには他のメンバーが何をしているかを把握しておく必要があります。







## コンフリクトの解消方法

## コンフリクトを避けるには
